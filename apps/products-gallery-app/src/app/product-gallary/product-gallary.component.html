<ion-header>
  <ion-toolbar>
   <ng-container  *ngIf="user|async as userInfo">
         <ion-thumbnail class="small-thumb"  slot="end"  *ngIf="userInfo && userInfo.photoURL">
        <ion-img [src]="userInfo.photoURL" />
      </ion-thumbnail>
    </ng-container>
          <ion-title>
            Products Gallary   </ion-title>
    <ion-buttons slot="start">
      <ion-button [routerLink]="['../edit-product', 'new']" routerLinkActive="router-link-active">
        <ion-icon slot="start" name="create"></ion-icon>
        جديد
      </ion-button>
    </ion-buttons>
    <ion-buttons slot="end">


      <ion-button (click)="logout()">
        <ion-icon slot="start" name="log-out-outline"></ion-icon>
                
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content>
  <store-app-repository-tags-input #productNameWordsInput type="array"
    [suggestions]="(suggestions|async) || []"></store-app-repository-tags-input>
  <store-app-repository-tags-input #productBatchsOptionValuesInput [showInputCtrl]=true type="array" label="الدفعة"
    [suggestions]="(productBatchsOptionValues$|async) || []"></store-app-repository-tags-input>
      <cdk-virtual-scroll-viewport itemSize="auto" class="ion-content-scroll-host">
    
      <ion-item *ngIf="docCount$|async as count, else noDocCount">
      <ion-label>found {{count}} products</ion-label>
    </ion-item>
    <ng-template #noDocCount>
      <ion-item >
        <ion-label> <ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></ion-label>
      </ion-item>
    </ng-template>
    
    <div class="gallary_container" *ngIf="!this.loaded; else loaded">
      <ng-container
        *ngFor="let  prod of [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]; let i=index">
        <div class="image_container">
          <ion-skeleton-text animated style="width: 100%; height: 100%;"></ion-skeleton-text>
        </div>
      </ng-container>
    </div>
    <ng-template #loaded>
      <div class="gallary_container" *ngIf=" products$|async as products ">

        <ng-container *ngFor="let  prod of ProductsInstance; trackBy: trackBy; let i=index">
          <div class="image_container" (click)="previewProduct === prod ? previewProduct= null : previewProduct = prod">
            <img style="object-fit: cover;" *ngIf="prod!.imageIds && prod!.imageIds![0]"
              [ngSrc]="prod!.imageIds![0]|imgIdtoThumbUre:200" alt="{{prod.name}}" priority="i<22" fill />
          </div>
          <div class="prod-preview" *ngIf="previewProduct === prod" [routerLink]="['../edit-product', prod.id]">
            <div class="prod-preview-content">

              <div class="card " style="flex: auto;">
                <div class=" card-content">
                  <div class="slides" *ngIf="prod!.imageIds && prod.imageIds[0]">
                    <div id="slide-1" class=" image_container" *ngFor="let item of prod!.imageIds">
                      <img  [src]="item |imgIdtoThumbUre:600" [storeAppRepositoryHydratedImg]="item |imgIdtoThumbUre:200" alt="{{prod.name}}" fill />
                    </div>
                  </div>
                </div>
                <ion-text class="card-title" color="primary">
                  <h1>{{prod.name}}</h1>
                </ion-text>

              </div>
            </div>

          </div>
          <ng-container *ngIf="products.length < 2">
            <div class="image_container placeholder">
            </div>
          </ng-container>
          <ng-container *ngIf="products.length < 3">
            <div class="image_container placeholder">
            </div>
          </ng-container>
        </ng-container>




      </div>
      <ion-infinite-scroll (ionInfinite)="onInfinitScroll($event)">
        <ion-infinite-scroll-content></ion-infinite-scroll-content>
      </ion-infinite-scroll>
    </ng-template>





    <!--           

    <ion-row   *ngIf="products$| async as products">
        <ion-col size="auto"  *cdkVirtualFor="let  prod of products; let i=index" class="photo-grid-item">
          <img  class="grid-img" [src]="getthumbUrl(prod!.imageIds![0])" alt="" />
        </ion-col>
</ion-row> -->


  </cdk-virtual-scroll-viewport>
</ion-content>