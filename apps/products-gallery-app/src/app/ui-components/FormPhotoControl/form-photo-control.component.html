<ion-item *ngIf="showBussyAlert && isBussy()" lines="none">
  <ion-text color="danger" class="form-error">
    Please wait to upload images. or remove un wanted images.
  </ion-text>
</ion-item>

<div class="container">

  <ion-row>
    <ion-col>
      <div class="big-thumb" (click)="openNativeFileInput()">

        <ion-thumbnail class="big-thumb">
          <ion-icon class="full-size" name="camera-outline"></ion-icon>
          <!-- <img src="../../../../assets/add-image.svg"> -->
        </ion-thumbnail>
      </div>
    </ion-col>

    <ion-col *ngIf='inputFiles && inputFiles.length>0'>
      <div [class.box-shadow-3d]="inputFiles.length > 1" class="big-thumb">

        <ion-fab vertical="top" horizontal="start" edge slot="fixed" *ngIf="!inputFiles[0].uploadTaskData?.snapshot">
          <ion-spinner name="bubbles"> {{inputFiles.length}}</ion-spinner>
        </ion-fab>
        <store-app-repository-upload-task [folderPath]='folderPath' [imgInfo]="inputFiles[0]"
          (click)="openPhotoModal(inputFiles)"
          (uploadComplete)="onDownloadUrlChangeFromThumb($event, inputFiles[0], inputFiles)"
          (cancel)="onUploadCancelFromThumb($event, inputFiles)">
        </store-app-repository-upload-task>
      </div>
    </ion-col>

    <ion-col *ngIf="sharedFilesInfo && sharedFilesInfo.length > 0">
      <div [class.box-shadow-3d]="sharedFilesInfo.length > 1" class="big-thumb">

        <ion-fab vertical="top" horizontal="start" edge slot="fixed"
          *ngIf="!sharedFilesInfo[0].uploadTaskData?.snapshot">
          <ion-fab-button size="small" (click)="onUploadCancelFromThumb(sharedFilesInfo[0], sharedFilesInfo)">
            <ion-icon name="close"></ion-icon>
          </ion-fab-button>
        </ion-fab>
        <store-app-repository-upload-task [folderPath]='folderPath' [imgInfo]="sharedFilesInfo[0]"
          (click)="openPhotoModal(sharedFilesInfo)"
          (uploadComplete)="onDownloadUrlChangeFromThumb($event, sharedFilesInfo[0], sharedFilesInfo)"
          (cancel)="onUploadCancelFromThumb(sharedFilesInfo[0], sharedFilesInfo)">
        </store-app-repository-upload-task>
        <!-- <ion-thumbnail class="big-thumb" style="opacity: 0.6;" (click)="openPhotoModal(index)">
              <ion-img [src]="sharedFile.imgUrl"></ion-img>
            </ion-thumbnail> -->
      </div>
    </ion-col>
    <ng-container *ngIf='value && value.length'>
      <ion-col *ngIf="value.length > 0">
        <div [class.box-shadow-3d]="value.length > 1" class="big-thumb">
          <ion-thumbnail class="big-thumb" (click)="openPhotoModal(value)">

            <ion-img [src]="value[0].imageId | imgIdtoThumbUre"></ion-img>
          </ion-thumbnail>
        </div>
      </ion-col>
    </ng-container>


    <!-- <ng-container *ngIf='newImgIds && newImgIds.length'>
      <ion-col>
        <div [class.box-shadow-3d]="newImgIds.length > 1" class="big-thumb" (click)="openPhotoModal(newImgIds)">
          <ion-thumbnail class="big-thumb">

            <ion-img [src]="uplodedImgFiles[0].uploadTaskData.downloadURL"></ion-img>
          </ion-thumbnail>
        </div>

      </ion-col>
    </ng-container> -->

  </ion-row>

</div>

<input type="file" id='fileInput' #fileInput hidden="true" (change)='onFileSelected($event);' multiple>



<ion-modal #modal (didDismiss)="modal.isOpen = false" [presentingElement]="presentingElement">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-buttons slot="start">
          <ion-button (click)="modal.dismiss()">
            <ion-icon slot="start" name="chevron-back-outline"></ion-icon>
          </ion-button>
        </ion-buttons>
        <ion-buttons slot="end">
          <ng-container *ngIf="showReorder;else showSlidesButton">
            <ion-button (click)="showReorder = !showReorder">
              <ion-icon slot="start" name="albums-outline"></ion-icon>
            </ion-button>
          </ng-container>
          <ng-template #showSlidesButton>
            <ion-button (click)="showReorder = !showReorder">
              <ion-icon slot="start" name="list-outline"></ion-icon>
            </ion-button>
          </ng-template>
        </ion-buttons>
        <ion-title>الصور</ion-title>
      </ion-toolbar>
    </ion-header>
    <ion-content class="modal-content ">

      <ng-container [ngSwitch]="modalFilesOrImgIds">
        <ng-container *ngSwitchCase="value">
          <ng-container *ngIf="showReorder;else showVerticalSlides">
            <ion-list>
              <!-- The reorder gesture is disabled by default, enable it to drag and drop items -->
              <!-- Casting $event to $any is a temporary fix for this bug https://github.com/ionic-team/ionic-framework/issues/24245 -->
              <ion-reorder-group [disabled]="false" (ionItemReorder)="handleReorder($any($event))">
                <ion-item *ngFor="let imgD of value, let index = index">
                  <ion-thumbnail class="big-thumb">
                    <img sclass="ion-margin-vertical" [src]="imgD.imageId|imgIdtoThumbUre:200"
                      [storeAppRepositoryHydratedImg]="imgD.imageId|imgIdtoThumbUre:600" />
                  </ion-thumbnail>

                  <ion-label>
                    <ion-button (click)="onIamgeRemoved(imgD.imageId)" expand="full">
                      <ion-icon name="trash-outline"></ion-icon>
                      remove
                    </ion-button>
                    <span> img no {{imgD.index}} </span>
                  </ion-label>
                  <ion-reorder slot="end"></ion-reorder>
                </ion-item>

              </ion-reorder-group>
            </ion-list>
          </ng-container>

          <ng-template #showVerticalSlides>
            <div class="container">
              <div class="ion-margin-bottom child" *ngFor='let imgId of value; let i=index '>
                <div class="c-relative-container ">
                  <ion-fab vertical="top" horizontal="center" slot="fixed">
                    <ion-fab-button (click)="onIamgeRemoved(imgId.imageId)" size="small">
                      <ion-icon name="trash-outline"></ion-icon>
                    </ion-fab-button>
                  </ion-fab>
                  <img class="ion-margin-vertical" style="width: 100%;"
                    [style.aspect-ratio]="imgId.metas[0].height/imgId.metas[0].width"
                    [src]="imgId.imageId|imgIdtoThumbUre:200"
                    [storeAppRepositoryHydratedImg]="imgId.imageId|imgIdtoThumbUre:600" />
                </div>
              </div>
            </div>
          </ng-template>


        </ng-container>

        <ng-container *ngSwitchCase="inputFiles">
          <div class="ion-margin-bottom" *ngFor='let file of inputFiles, let index,trackBy:trackByFileId'>
            <div class="relative-container">
              <store-app-repository-upload-task [slideMode]="true" [folderPath]='folderPath' [imgInfo]="file"
                (uploadComplete)="onFileUploadCompleted($event, file, inputFiles)"
                (cancel)="onUploadCancel($event, inputFiles)">
              </store-app-repository-upload-task>
            </div>
          </div>
        </ng-container>

        <ng-container *ngSwitchCase="sharedFilesInfo">
          <div class="container">
            <div class="ion-margin-bottom" *ngFor='let file of sharedFilesInfo, let index'>
              <div [id]="index">
                <div class="relative-container">
                  <store-app-repository-upload-task [slideMode]="true" [folderPath]='folderPath' [imgInfo]="file"
                    (uploadComplete)="onFileUploadCompleted($event, file, sharedFilesInfo)"
                    (cancel)="onUploadCancel(file, sharedFilesInfo)">
                  </store-app-repository-upload-task>
                </div>
              </div>
            </div>
          </div>


        </ng-container>


        <!-- 
        <ng-container *ngSwitchCase="newImgIds">

          <div class="ion-margin-bottom" *ngFor='let img of uplodedImgFiles; let index'>
            <div [id]="index">
              <div class="relative-container">
                <div style="position: relative;" class='ion-margin'>
                  <ion-fab vertical="top" horizontal="center" edge slot="fixed">
                    <ion-fab-button (click)="onIamgeRemoved(img.docId)" size="small">
                      <ion-icon name="trash-outline"></ion-icon>
                    </ion-fab-button>
                  </ion-fab>
                  <ion-img [src]="img.uploadTaskData.downloadURL"></ion-img>
                </div>
              </div>
            </div>
          </div>

        </ng-container> -->
      </ng-container>
    </ion-content>
  </ng-template>
</ion-modal>